name: Build and Deploy

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repo
      - name: Checkout repo
        uses: actions/checkout@v3


      # Step 3: Install dependencies
      - run: npm install
        working-directory: calendar_test

      # Step 4: Build project
      - run: npm run build
        working-directory: calendar_test

      # Step 5: Push build folder to separate branch
      - name: Push build folder to build branch
        run: |
          # Configure git
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Checkout the target branch (create if it doesn't exist)
          git fetch origin build || true
          git checkout build || git checkout --orphan build

          # Remove existing files
          git rm -rf . || true

          # Copy build folder contents to root
          cp -r ./calendar_test/build/* ./

          rm -rf calendar_test
          # Add and commit
          git add .
          git commit -m "Deploy build folder [skip ci]" || echo "No changes to commit"

          # Push to build branch
          git push origin build --force
